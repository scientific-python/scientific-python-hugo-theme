version: 2.1

jobs:
  build:
    working_directory: ~/scientific-python-hugo-theme
    docker:
      - image: cibuilds/hugo:latest

    steps:
      - checkout

      - run:
          name: Install hugo theme
          command: git submodule update --init --recursive

      - run:
          name: Build site
          command: |
            sed -i '/^theme/a relativeURLs: true' doc/config.yml
            sed -i '/^theme/a themesdir: "../.."' doc/config.yml
            sed -i 's/getstarted/getstarted\/index.html/g' doc/config.yml
            sed -i 's/link: \//link: \/index.html/g' doc/config.yml
            cd doc ; hugo

      - store_artifacts:
          path: doc/public/
