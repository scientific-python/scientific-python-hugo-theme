<!-- Include all theme CSS filenames here -->
{{- $page := . -}}
{{- $cssFiles := resources.Match "css/*.css" -}}

{{- $inServerMode := .Site.IsServer -}}
{{- $sass         := (slice "css/fresh/core.scss") -}}
{{- $cssOpts      := cond ($inServerMode) (dict "enableSourceMap" true) (dict "outputStyle" "compressed") -}}

<!-- Fonts -->
{{- $fontName     := .Site.Params.font.name | default "Open Sans" -}}
{{- $fontFace     := replace $fontName " " "+" -}}
{{- $fontSizes    := delimit (.Site.Params.font.sizes | default (slice 300 400 600 700)) "," -}}
{{- $fontUrl      := printf "https://fonts.googleapis.com/css?family=%s:%s" $fontFace $fontSizes -}}
<link href="{{ $fontUrl }}" rel="stylesheet">

<!-- Favicon -->
<link rel="icon" href="{{ "images/favicon.ico" | relURL }}" />

<!-- SASS --- currently only for fresh -->
{{- range $sass -}}

{{- if $inServerMode -}}
{{- $css := resources.Get . | toCSS $cssOpts -}}
<link rel="stylesheet" type="text/css" href="{{ $css.RelPermalink }}">
{{ else }}
{{- $css := resources.Get . | toCSS $cssOpts | minify | fingerprint -}}
<link rel="stylesheet" type="text/css" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">
{{- end -}}

{{- end -}}

{{- range $cssFiles -}}

{{- $targetFile := printf "css/%s.css" . -}}

{{ if $inServerMode -}}
{{ $custom_style := . | resources.ExecuteAsTemplate $targetFile $page -}}
<link rel="stylesheet" href="{{ $custom_style.RelPermalink }}">
{{ else }}
{{- $custom_style := . | resources.ExecuteAsTemplate $targetFile $page | minify | fingerprint -}}
<link rel="stylesheet" href="{{ $custom_style.RelPermalink }}" integrity="{{ $custom_style.Data.Integrity }}">
{{- end -}}

{{- end -}}
