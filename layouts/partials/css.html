<!-- Include all theme CSS filenames here -->
{{- $page := . -}}

{{- $inServerMode := .Site.IsServer -}}
{{- $serverOpts := cond ($inServerMode) (dict "enableSourceMap" true) (dict "outputStyle" "compressed") -}}
{{- $sassCompiler := dict "transpiler" "dartsass" -}}
{{- $cssOpts := collections.Merge $sassCompiler $serverOpts -}}
{{- $sass := (slice "theme-css/pst/pydata-sphinx-theme.scss") -}}

<!-- Fonts -->
{{- $fontName := .Site.Params.font.name | default "Open Sans" -}}
{{- $fontFace := replace $fontName " " "+" -}}
{{- $fontSizes := delimit (.Site.Params.font.sizes | default (slice 300 400 600 700)) ";" -}}
{{- $fontUrl := printf "https://fonts.googleapis.com/css2?family=%s:wght@%s" $fontFace $fontSizes -}}

<link rel="icon" href="{{ "images/favicon.ico" | relURL }}" />

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="{{ $fontUrl }}">

<!-- Fallback font for symbols (such as "ðŸ›ˆ"). --
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+Symbols+2">

<!-- SASS -->
{{- range $sass -}}

{{- if $inServerMode -}}
{{ $css := resources.Get . | toCSS $cssOpts -}}
<link rel="stylesheet" type="text/css" href="{{ $css.RelPermalink }}">
{{ else }}
{{ $css := resources.Get . | toCSS $cssOpts | minify | fingerprint -}}
<link rel="stylesheet" type="text/css" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}">
{{- end -}}

{{- end -}}

{{- $themeCssFiles := resources.Match "theme-css/*.css" -}}
{{- $userCssFiles := resources.Match "css/*.css" -}}
{{- $cssFiles := $themeCssFiles | append $userCssFiles }}

{{- range $cssFiles -}}

{{- $targetFile := printf "css/%s" . -}}

{{ if $inServerMode -}}
{{ $custom_style := . | resources.ExecuteAsTemplate $targetFile $page -}}
<link rel="stylesheet" href="{{ $custom_style.RelPermalink }}">
{{ else }}
{{ $custom_style := . | resources.ExecuteAsTemplate $targetFile $page | minify | fingerprint -}}
<link rel="stylesheet" href="{{ $custom_style.RelPermalink }}" integrity="{{ $custom_style.Data.Integrity }}">
{{- end -}}

{{- end -}}
